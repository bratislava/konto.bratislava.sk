# Úprava a nahrávanie existujúcich elektronických formulárov do upvs/slovensko.sk

Návod - úprava a nahrávanie existujúcich elektronických formulárov:

- stiahnuť a rozbaliť existujúci zip
- prepísať čo chceme zmeniť
- ak meníme verziu, zmeniť ju všade, je referencovaná vo väčšine súborov (najlepšie je robiť vyhľadávanie nad celým directory) - kontkrétne v data.xml, meta.xml, schema.xsd a skoro vo všetkých súboroch v priečinku Content (všetky transformácie a vzorové výsledky transformácii - súbory .xml, xslt, xsl, xsd - môžu sa teoreticky náchádzať aj v inom priečinku alebo v koreni) okrem \*.dct súboru
- prepísať v meta.xml **dc:creator** na meno gestora - človek ktorý bude nahrávať formulárový vzor, resp. cez ktorého [slovensko.sk](http://slovensko.sk/) účet bude nahrávaný. V prípade fix prostredia je to u nás vždy “Tisici Janko”. Nemám otestované či validácia formuláru prejde aj pre cudzie meno alebo či musí sedieť s prihláseným účtom. Pozor na to, že gestora pre dané formulárové id pri update verzie nejde zmeniť, musí ostať ten istý. Aj keď je na toto pole pri nahrávaní do [formulare.slovensko.sk](http://formulare.slovensko.sk/), musí sa to zmeniť ešte v meta.xml, na stránke sa už meniť nedá.
- optionally, prepísať v meta.xml **meta:inForceFrom** a **meta:validDateFrom**, môže to byť ten istý deň, na fixe to môže byť dnešný dátum, na produkcii musí byť aspoň o jeden deň vopred. Toto sa dá prepísať pri nahrávaní do [formulare.slovensko.sk](http://formulare.slovensko.sk/).
- spraviť zip archív - musí byť robený “z vnútra” directory v ktorom sa nachádzajú všetky formulárové súbory. Teda napríklad súbor meta.xml nesmie byť v žiadnom subdirectory ale priamo v koreni archívu.
- nahrávanie na fix prostredie cez <https://formulare.upvsfixnew.gov.sk/> (treba ísť cez VPN a mať správny lokálny setup aby sme sa dovolali), na produkciu <https://formulare.slovensko.sk/>. V oboch prípadoch treba byť prihlásený do ako “Hlavné mesto SR Bratislava”.
- (screenshot) V časti Žiadosti - Vloženie vzoru eformulára - vybrať nami vytvorený zip archív, typ nechať ako “EFORM_STANDARD_ZIP_PACKAGE”, kliknúť na Pridať. Po pridaní by sa mali korektne vyplniť všetky povinné polia - ak sa tak nestalo, formát .zip packageu je pravdepodobne nesprávny. V tomto bode je možnosť zmeniť dátum zverejnenia/platnosti alebo doplniť časť “Postup spracovania posp” podľa potreby
- To či bol zip naozaj správny sa dozvieme až pri validácii - je možné ju spustiť bez zverejnenia formulára, tlačítkom “Validovať“. Rovnaká Validácia prebehne aj pri Odoslaní formulára, rozdiel je ten že pokiaľ je validácia úspešná, formulár sa následne aj zverejní. Výsledok validácie sa nedozvieme hneď, treba ho hľadať v elektronickej schránke príslušného prostredia. ([schranka.upvsfixnew.gov.sk](http://schranka.upvsfixnew.gov.sk/) alebo [schranka.slovensko.sk](http://schranka.slovensko.sk/)). Chodí do niekoľkých minút, ak ho neuvidíme medzi prijatými súbormi bol spracovaný spolu s ostatnou poštou a skončil v príslušnej zložke schránky (na prode sú nazvané podľa aktuálneho roku, na fixe končia v “Stiahnute G - Ostatni T” . Toto záleží aj od aktuálnej GINIS/RPOD integrácie, pre prípad že tento návod prežije dosť dlho aby sa tieto zmenili.). Dnes majú tieto emaily vždy titul “Validačný report 02". V nich je set warningov a errorov - warning nás nezastaví od zverejnenia formulára, error áno. Ak sme formulár dali “Odoslať“, tak v prípade že v ňom nebol žiaden error nasleduje po krátkej chvíli aj “Potvrdenka o zaevidovaní žiadosti”. Keď sa objaví tá tak formulár bude zverejnený, v prípade že nastane chyba pri validácii mala by miesto nej prísť Chyba pri zaevidovaní žiadosti. Existuje edgecase chýb pri ktorých táto nemusí prísť.
- Errory vo Validačnom reporte sú často pomerne čitateľné a dá sa podľa nich opraviť potrebná chyba v súboroch formulára, následne je možné zmenený formulár validovať/odoslať znova.
- Validácia na oboch prostrediach je rovnaká, jediná výnimka je že na fixe možno dať dnešný dátum zverejnenia/platnosti, na produkcii smie byť najskôr od zajtra (a toto nás zastaví už pri submite formulára).
- pozor na formát zipu - vo vnútri archívu nemôže byť subdirectory, súbory meta.xml, schema.xsd, data.xml, mimetype, schema.xsd, attachments.xml by sa mali nachádzať v koreni archívu
- pozor na formátovanie súboru, špeciálne ak automatické formátovanie editoru (je dobré ho pri tejto práci vypnúť) pridá nové riadky alebo whitespaces tak NASES to niekedy nevie spracovať. Netýka sa všetkých súborov, týka sa hlavne meta.xml, pri ostatných však neotestované. Dobré dať si pozor aj na zachovanie encodingu.
- gestor vyzerá že musí byť rovnaký ako prihlásený používateľ - prepíše sa automaticky na “frontende” formulárov, ak sa to dá obísť tak neviem ako
- formulár nevie pri uprgrade verzíí zmeniť gestora - ak bol niektorý formulár nahraný niekým iným, viem novšiu verziu nahrať iba pod iným id
